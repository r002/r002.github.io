<!doctype html>
<html>
<head>
  <title>fiction/1 redirect</title>
  <script type="module">
    const path = window.location.href;

    const u = new URL(path);
    const pageNo = u.searchParams.get('p');
    const action = u.searchParams.get('a');
    // console.log("target page:", p);

    const j = await fetch("manifest.json");
    const manifest = await j.json();
    // console.log("manifest:", manifest);

    const shortlinks = {
      latest: manifest[manifest.length-1].url,
      first: manifest[1].url,
      intro: manifest[0].url
    }

    try {
      if (action === "prev") {
        // http://localhost:5001/fiction/1?p=1&a=prev
        const target = manifest[Number(pageNo) - 1];
        window.location.href = target.url;
      }
      else if (action === "next") {
        // http://localhost:5001/fiction/1?p=1&a=next
        const target = manifest[Number(pageNo) + 1];
        window.location.href = target.url;
      }
      else if (shortlinks.hasOwnProperty(pageNo)) {
        window.location.href = shortlinks[pageNo];
      }
      else if (manifest[pageNo]) {
        window.location.href = manifest[pageNo].url;
      }
    } catch (e) {
      console.error("Redirect error:", e);
      alert("Sorry! Couldn't find the page you requested. Click OK to redirect back to manifest.");
      window.location.href = `https://robertlin.substack.com/p/fiction-manifest`;
    }
  </script>
</head>
<body>
    <!-- <div>
      <h1>fiction/1 redirect</h1>
      <div id="placeholder">
          <p>This is the `fiction/1 redirect` page.</p>
      </div>
    </div> -->

</body>
</html>
